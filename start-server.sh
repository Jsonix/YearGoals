#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./start-server.sh [–ø–æ—Ä—Ç]

PORT=${1:-8000}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ—Ä—Ç–∞
check_port() {
    lsof -ti:$1 > /dev/null 2>&1
}

# –ï—Å–ª–∏ –ø–æ—Ä—Ç –∑–∞–Ω—è—Ç, –Ω–∞–π—Ç–∏ —Å–≤–æ–±–æ–¥–Ω—ã–π
if check_port $PORT; then
    echo "‚ö†Ô∏è  –ü–æ—Ä—Ç $PORT –∑–∞–Ω—è—Ç. –ò—â—É —Å–≤–æ–±–æ–¥–Ω—ã–π –ø–æ—Ä—Ç..."
    ORIGINAL_PORT=$PORT
    while check_port $PORT; do
        PORT=$((PORT + 1))
        if [ $PORT -gt 65535 ]; then
            echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Å–≤–æ–±–æ–¥–Ω—ã–π –ø–æ—Ä—Ç"
            exit 1
        fi
    done
    echo "‚úÖ –ù–∞–π–¥–µ–Ω —Å–≤–æ–±–æ–¥–Ω—ã–π –ø–æ—Ä—Ç: $PORT (–≤–º–µ—Å—Ç–æ $ORIGINAL_PORT)"
fi

echo "üöÄ –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –ø–æ—Ä—Ç—É $PORT..."
echo "üìÇ –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:$PORT"
echo "‚èπÔ∏è  –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C"
echo ""

python3 -m http.server $PORT

